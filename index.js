var S=Symbol.for("#__init__"),E=Symbol.for("#__initor__"),Q=Symbol.for("#__inited__"),B=Symbol.for("#__hooks__"),A=Symbol.for("#__patch__"),D=Symbol.for("#has"),V=Symbol.for("#meta"),W=Symbol.for("imba"),O=Symbol.for("#__mixin__"),K=Symbol.for("#matcher"),M=Symbol.for("#L"),i=Symbol.for("#appendChild"),C=Symbol.for("#afterVisit"),j=Symbol.for("#beforeReconcile"),g=Symbol.for("#afterReconcile"),d=Symbol.for("##up");var q={IsExtension:1,IsTag:2,HasDescriptors:4,HasSuperCalls:8,HasConstructor:16,HasFields:32,HasMixins:64,HasInitor:128,HasDecorators:256,IsObjectExtension:512},P=new Map,X=globalThis[W]||={counter:0,classes:P};function U(h,n={}){return P.has(h)||P.set(h,{symbol:Symbol(h.name),parent:Object.getPrototypeOf(h.prototype)?.constructor,for:h,uses:null,inits:null,id:X.counter++,...n}),P.get(h)}function R(h,n){return typeof n==="string"?typeof h===n:n?.[Symbol.hasInstance]?.(h)}function Y(h,n){if(!h||!n)return!1;if(h.get)return n.get===h.get;if(h.set)return n.set===h.set;if(h.value)return h.value===n.value}function G(h,n,r,u={}){let o=h.constructor;if(!r&&n){if(r=Object.getOwnPropertyDescriptors(n),delete r.constructor,r[S])console.warn(`Cannot define plain fields when extending class ${o.name}`),delete r[S]}let z=U(o);if(z&&z.augments){let I=new Map;for(let f of Object.keys(r)){let v=Object.getOwnPropertyDescriptor(h,f);for(let w of z.augments){let F=I.get(w);F||I.set(w,F={});let T=Object.getOwnPropertyDescriptor(w.prototype,f);if(T&&!Y(v,T))console.warn("wont extend",f,T,v);else F[f]=r[f]}}for(let[f,v]of I)if(Object.keys(v).length)G(f.prototype,null,v)}return Object.defineProperties(h,r),h}function H(h,n){let r=U(h),u=U(n);if(u.parent){if(!(h.prototype instanceof u.parent))throw new Error(`Mixin ${n.name} has superclass not present in target class`)}if(!u.augments){u.augments=new Set;let z=u.ref=Symbol(n.name),I=Object[Symbol.hasInstance];n.prototype[z]=!0,Object.defineProperty(n,Symbol.hasInstance,{value:function(f){return this===n?f&&!!f[z]:I.call(this,f)}})}if(h.prototype[u.ref])return h;if(u.uses)for(let z of u.uses)H(h,z);u.augments.add(h),r.uses||=[],r.uses.push(n);let o=Object.getOwnPropertyDescriptors(n.prototype);if(delete o.constructor,o[S])r.inits||=[],r.inits.push(n.prototype[S]),delete o[S];if(Object.defineProperties(h.prototype,o),n?.mixed instanceof Function)n.mixed(h);return h}var c={cache:{},self:null,target:null,proxy:new Proxy({},{apply:(h,n,...r)=>{return c.target[n].apply(c.self,r)},get:(h,n)=>{return Reflect.get(c.target,n,c.self)},set:(h,n,r,u)=>{return Reflect.set(c.target,n,r,c.self)}})};function J(h,n,r,u,o=null){let z=Object.getPrototypeOf(h.prototype),I=u&q.HasMixins,f;if(I)P.set(h,P.get(z.constructor)),z=Object.getPrototypeOf(z);if(o){let w=u&q.IsObjectExtension?o:o.prototype,F=U(h);if(F.uses){if(o===w)console.warn("Cannot extend object with mixins");for(let T of F.uses)H(o,T)}if(u&q.HasSuperCalls)c.cache[n]=Object.create(Object.getPrototypeOf(w),Object.getOwnPropertyDescriptors(w));return G(w,h.prototype),o}let v=z?.constructor;if(f=U(h,{symbol:n}),Object.defineProperty(h,V,{value:f,enumerable:!1,configurable:!0}),r&&h.name!==r)Object.defineProperty(h,"name",{value:r,configurable:!0});if(f.flags=u,u&q.HasConstructor)h.prototype[E]=n;if(f.uses)for(let w of f.uses)w.mixes?.(h);if(v?.inherited instanceof Function)v.inherited(h);return h}function L(h,n){if(h[E]===n)h[Q]?.(),h[B]&&h[B].inited(h)}var N=Symbol();class Z{[S](h=null,n=!0,r=!0){var u;this.onready=h?h.onready:void 0,this.onerror=h?h.onerror:void 0,this.onchange=h?h.onchange:void 0,this.languages=h&&(u=h.languages)!==void 0?u:{},this.preferred=h&&(u=h.preferred)!==void 0?u:(window?.navigator?.language||"en-US").slice(0,2),this.default=h?h.default:void 0}constructor(h,n="en"){var r=this;return this[S](),this.default=n,window.fetch(h).then(function(u){return u.json()}).then(function(u){return r._finalize(u,void 0)}).catch(function(u){return r._finalize(void 0,u)}),new Proxy(this,{get:function(u,o,z){if(r[o])return Reflect.get(u,o,z);if(u.languages[o])return u.languages[o];if(u.languages[r.active]&&u.languages[r.active][o])return u.languages[r.active][o];if(R(r.onerror,Function))r.onerror("no_localization_key",o);return""}});L(this,N)}_finalize(h,n){if(n){if(R(this.onerror,Function))this.onerror("no_localization_file",n);else console.log("Localization file was not loaded",n);return}if(h)this.languages=h;if(!this.languages[this.default]){if(R(this.onerror,Function))this.onerror("no_default_localization",this.default);else console.log("There is no Localization for the default language",this.default);return}if(this.active=this.preferred,R(this.onready,Function))return this.onready()}get active(){let h=window.localStorage.getItem("imba-localization");if(h&&this.languages[h])return h;if(this.languages[this.preferred])return this.preferred;return this.default}set active(h){if(h=h&&this.languages[h]?h:this.active,window.localStorage.getItem("imba-localization")!=h){if(window.localStorage.setItem("imba-localization",h),R(this.onchange,Function))this.onchange(h)}}static{J(this,N,"Localization",16)}}export{Z as Localization};
